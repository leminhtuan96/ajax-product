<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon"
        href="data:image/png;base64,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" />
    <title>Product</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <style>


    </style>
</head>

<body>
    <div class="container">
        <form method="" class="mt-3 myCreate">
            <h3>Create</h3>
            <div class="form-group">
                <label for="exampleInputEmail1">Name</label>
                <input type="text" class="form-control" id="name" aria-describedby="emailHelp">
            </div>
            <div class="form-group">
                <label for="price">Price</label>
                <input type="text" class="form-control" id="price">
            </div>
            <div class="form-group mt-3 mb-3">
                <label for="disabledSelect" class="form-label" for="status">Status</label>
                <select id="status" class="form-select">
                    <option value="y">Yes</option>
                    <option value="n">No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="exampleInputPassword1">Image</label>
                <input type="file" accept="image/*" class="form-control" id="image">
            </div>
            <div class="form-group mt-3">
                <label for="exampleInputPassword1">Description</label>
                <textarea style="hidden" class="form-control" id="description"></textarea>
            </div>

            <button type="button" id="submit-products" class="btn btn-primary mt-3">Submit</button>


        </form>
        <form method="" class="mt-3 myEdit" style="display: none">
            <input type="hidden" id="product-id" />
            <input type="hidden" name="PUT" value="PUT">
            <h3>Update</h3>
            <div class="form-group">
                <label for="exampleInputEmail1">Name</label>
                <input type="text" class="form-control" id="name-edit" aria-describedby="emailHelp">
            </div>
            <div class="form-group">
                <label for="price">Price</label>
                <input type="text" class="form-control" id="price-edit">
            </div>
            <div class="form-group mt-3 mb-3">
                <label for="disabledSelect" class="form-label" for="status">Status</label>
                <select id="status-edit" class="form-select">
                    <option value="y">Yes</option>
                    <option value="n">No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="exampleInputPassword1">Image</label>
                <input type="file" accept="image/*" class="form-control" id="image-edit">
            </div>
            <div class="form-group mt-3">
                <label for="exampleInputPassword1">Description</label>
                <textarea style="hidden" class="form-control" id="description-edit"></textarea>
            </div>

            <button type="button" id="edit-products" class="btn btn-primary mt-3">Update</button>
            <button type="button" id="cancel-products" class="btn btn-warning mt-3">Cancel</button>


        </form>
        <table class="table table-dark mt-5" id="products-table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Image</th>
                    <th scope="col">Price</th>
                    <th scope="col">Status</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
        integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js"
        integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy" crossorigin="anonymous">
    </script>
</body>
<script>
    $(document).ready(function() {
        getProducts();

        //create product
        $("#submit-products").on("click", function() {
            let formData = new FormData();
            formData.append('name', $("#name").val());
            formData.append('image', $('#image')[0].files[0]);
            formData.append('price', $("#price").val());
            formData.append('status', $("#status").val());
            formData.append('description', $("#description").val());
            $("input, textarea, select").val("");
            $.ajax({
                url: "api/products/create",
                type: "post",
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                success: function(response) {
                    $('tbody').prepend('<tr>' +
                        '<th scope="row" class="product-index">' + response.data.id +
                        '</th>' +
                        '<td>' + response.data.name + '</td>' +
                        '<td><img src="storage/' + response.data.image +
                        '" width="100px" height="70" alt=""></td>' +
                        '<td>' + response.data.price + '</td>' +
                        '<td>' + response.data.status + '</td>' +
                        '<td>' +
                        '<a class="me-2 edit-product btn btn-primary" data-id="' +
                        response.data.id +
                        '">Edit</a>' +
                        '<a class="delete-product btn btn-danger" data-id="' +
                        response.data.id +
                        '">Delete</a>' +
                        '</td>' +
                        '</tr>'
                    )
                    changeProductIndex();
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                },
            });

        });

        //delete product
        $(document).on('click', '.delete-product', function() {
            let del_id = $(this).attr('data-id');
            if (del_id) {
                if (confirm("Are you sure to delete this!")) {
                    $.ajax({
                        url: "api/product/" + del_id,
                        type: "delete",
                        dataType: "json",
                        success: function(response) {
                            if (response.code == 200) {
                                let deleted_element = $(
                                    `.delete-product[data-id=${del_id}]`);
                                deleted_element.parent().parent().remove();
                            }
                            changeProductIndex();
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            console.log(textStatus, errorThrown);
                        },
                    });
                }
            }
        });


        //edit product
        $(document).on('click', '.edit-product', function() {
            $('.myCreate').css({
                'display': 'none',
            })
            $('.myEdit').css({
                'display': 'block',
            });
            let edit_id = $(this).attr('data-id');
            $.ajax({
                type: "get",
                url: "/api/product/detail/" + edit_id,
                success: function(response) {
                    if (response.code == 200) {
                        $('#product-id').val(response.data[0].id),
                            $('#name-edit').val(response.data[0].name),
                            $('#price-edit').val(response.data[0].price),
                            $('#status-edit').val(response.data[0].status),
                            $('#description-edit').val(response.data[0].description)
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                }
            });
        });

        $('#cancel-products').on('click', function() {
            $('.myCreate').css({
                'display': 'block'
            })
            $('.myEdit').css({
                'display': 'none'
            })
        });

        //update product
        $('#edit-products').on("click", function() {
            let formData = new FormData();
            let edit_id = $('#product-id').val();
            formData.append('id', $('#product-id').val());
            formData.append('name', $("#name-edit").val());
            formData.append('image', $('#image-edit')[0].files[0]);
            formData.append('price', $("#price-edit").val());
            formData.append('status', $("#status-edit").val());
            formData.append('description', $("#description-edit").val());
            $.ajax({
                url: "api/product/edit/" + edit_id,
                type: "post",
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                success: function(response) {
                    let editProductRow = $(
                        `.edit-product[data-id=${edit_id}]`).parent().parent();
                    editProductRow.html('');

                    let newProductHtml = '<th scope="row" class="product-index">' + response
                        .data.id +
                        '</th>' +
                        '<td>' + response.data.name + '</td>' +
                        '<td><img src="storage/' + response.data.image +
                        '" width="100px" height="70" alt=""></td>' +
                        '<td>' + response.data.price + '</td>' +
                        '<td>' + response.data.status + '</td>' +
                        '<td>' +
                        '<a class="me-2 edit-product btn btn-primary" data-id="' +
                        response.data.id +
                        '">Edit</a>' +
                        '<a class="delete-product btn btn-danger" data-id="' +
                        response.data.id +
                        '">Delete</a>' +
                        '</td>';
                        editProductRow.html(newProductHtml);
                    $("input, textarea, select").val("");

                    changeProductIndex();
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                },
            });
        });


        //sá»­a id index
        function changeProductIndex() {
            $('.product-index').text('')
            $('.product-index').each(function(index, value) {
                $(value).text(index + 1)
            });
        }

        //function show list
        function getProducts() {
            $.ajax({
                type: 'GET',
                dataType: "json",
                url: 'api/product',
                success: function(response, status, xhr) {
                    if (response.code == 200) {
                        let data = response.data
                        let productHtml = "";
                        data.forEach((element, index) => {
                            productHtml += '<tr>' +
                                '<th scope="row" class="product-index">' + (index + 1) +
                                '</th>' +
                                '<td>' + element.name + '</td>' +
                                '<td><img src="storage/' + element.image +
                                '" width="100px" height="70" alt=""></td>' +
                                '<td>' + element.price + '</td>' +
                                '<td>' + element.status + '</td>' +
                                '<td>' +
                                '<a class="me-2 edit-product btn btn-primary" data-id="' +
                                element.id +
                                '">Edit</a>' +
                                '<a class="delete-product btn btn-danger" data-id="' +
                                element
                                .id +
                                '">Delete</a>' +
                                '</td>' +
                                '</tr>'
                        });
                        $("#products-table tbody").html(productHtml);
                    }
                },
                error: function(err, status) {
                    console.log(err);
                }
            });
        }
    });
</script>

</html>
